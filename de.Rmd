---
params: 
  title: ""
  publication_date: ""
  doi: ""
  github: ""
  lang: ""
output: 
  html_document:
    anchor_sections: false
    theme: null
    highlight: null
    mathjax: null
    css: ["style.css", "https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700&display=swap"]
    self_contained: true
# # To produce Word output, just comment the output lines above and uncomment 
# # the ones here. 
# output: word_document
# always_allow_html: yes
title: "`r params$title`"
---

```{r general-setup, include=FALSE}
## This file contains the GERMAN version of the data story

# Set general chunk options
knitr::opts_chunk$set(
  echo = FALSE, fig.showtext = TRUE, fig.retina = 3,
  fig.align = "center", warning = FALSE, message = FALSE
)

# Install snf.datastory package if not available, otherwise load it
if (!require("snf.datastory")) {
  if (!require("devtools")) {
    install.packages("devtools")
    library(devtools)
  }
  install_github("snsf-data/snf.datastory")
  library(snf.datastory)
}

# Load packages
library(tidyverse)
library(lubridate)
library(scales)
library(conflicted)
library(jsonlite)
library(here)
library(glue)
library(ggiraph)
library(treemapify)

# Conflict preferences
conflict_prefer("filter", "dplyr")
conflict_prefer("get_datastory_theme", "snf.datastory")
conflict_prefer("get_datastory_scheme", "snf.datastory")

# Increase showtext package font resolution
showtext_opts(dpi = 320)

# Set the locale for date formatting (Windows)
Sys.setlocale("LC_TIME", "German")

# Set the language for this rmd for translate function
lang <- "de"

# Create function to print number with local language-specific format
print_num <- function(x) snf.datastory::print_num(x, lang = lang)

# Knitr hook for local formatting of printed numbers
knitr::knit_hooks$set(
  inline <- function(x) {
    if (!is.numeric(x)) {
      x
    } else {
      print_num(x)
    }
  }
)

# Function that returns the desired language version of a string, given three
# language strings are provided to the function 
translate <- function(en_string = "NOT TRANSLATED",
                      de_string = "NOT TRANSLATED",
                      fr_string = "NOT TRANSLATED",
                      lang = "en") {
  string <- case_when(lang == "en" ~ en_string, 
                      lang == "de" ~ de_string, 
                      lang == "fr" ~ fr_string, 
                      TRUE ~ "NO VALID LANGUAGE SPECIFIED")
  string
}

```

```{r print-header-infos, results='asis'}
# Add publication date to header
cat(format(as_datetime(params$publication_date), "%d.%m.%Y"))
```

```{r story-specific-setup, include=FALSE}
# Set story-specific variables etc. here

# load data comparing the different classifiers
load(here("data/sdg_mentions_all.RData"))

# load data with information regarding the mentions of sdgs (one line per grant)
load(here("data/data_grants_w_sdg.RData"))

# load data with information regarding the sdgs (one line per sdg, one grant
# can appear multiple times)
load(here("data/data_sdgs.RData"))

# load data with information regarding the disciplines involved in projects with
# reference to sdg 07 (one line per grant)
load(here("data/data_sdg07_disciplines.RData"))

# load data with information regarding the collaborations involved in projects 
# reference to sdg 07 (one line per collaboration)
load(here("data/data_sdg07_collaborations.RData"))

# make vector with sdg-colors (working with 16 sdgs)
sdg_16_colors <- c("#E5243B", "#DDA63A", "#4C9F38", "#C5192D", "#FF3A21",
                            "#26BDE2", "#FCC30B", "#A21942", "#FD6925", "#DD1367",
                            "#FD9D24", "#BF8B2E", "#3F7E44", "#0A97D9", "#56C02B",
                            "#00689D")
                            
# make vector with sdg-colors (working with 17 sdgs)
sdg_17_colors <- c("#E5243B", "#DDA63A", "#4C9F38", "#C5192D", "#FF3A21",
                            "#26BDE2", "#FCC30B", "#A21942", "#FD6925", "#DD1367",
                            "#FD9D24", "#BF8B2E", "#3F7E44", "#0A97D9", "#56C02B",
                            "#00689D", "#19486A")
                            

# define the different plot types
# plot_type1: barplot displaying SDGs faceting by another variable
plot_type1 <- function(data, facet_var, result_var,
                       y_max, upper_break, break_length,
                       sdg_color_scheme){
  
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_facet := facet_var,
           selected_result := result_var) %>%
    ggplot(aes(x = selected_result, 
               y = percentage, 
               fill = selected_result)) + 
    # choose the color
    geom_col(width = 0.75) + 
    geom_text(
      # get the percentage plus the number of cases printed as a label
      aes(
        label =
          if_else(
            percentage > 0, 
            paste0(print_num(round(percentage * 100, digits = 2)), "%"),
            ""
          ),
        # print the label outside of the bar 
        y =
          if_else(
            percentage > 0.2,
            percentage - (max(percentage) / 25),
            percentage + (max(percentage) / 25)
          ),
        hjust =
          if_else(
            percentage > 0.2,
            1,
            0
          )
      ),
      color = "#4C4C4C",
      size = 2.5, 
      family = "Theinhardt"
    ) + 
    facet_wrap(vars(selected_facet)) +
    coord_flip() +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", y = NULL) +
    get_datastory_theme() +
    # adjust the labels of the x-axis such that they don't overlap
    theme(axis.text.x = element_text(hjust = 0.5)) +
    # set the color scheme for the different sdgs
    scale_fill_manual(values = rev(sdg_color_scheme)) +
    # get rid of legend
    theme(legend.position = "none",
          panel.background = element_rect(fill = "#DAF1FC"),
          plot.background = element_rect(fill = "#DAF1FC", color = NA),
          panel.grid = element_blank())
  
}

# plot_type2: barplot displaying proportion of grants per selected category 
plot_type2 <- function(data, cat_var, facet_text,
                       y_max, upper_break, break_length){
  
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    mutate(facet_text = facet_text) %>%
    ggplot(aes(x = selected_category, 
               y = percentage)) + 
    # choose the color
    geom_col(fill = get_datastory_scheme()[1]) + 
    geom_text(
      # get the percentage plus the number of cases printed as a label
      aes(label = if_else(percentage > 0, 
                          paste0(round(percentage * 100, digits = 0), "%",
                                 "\n", "n = ", print_num(n)), ""),
          # print the label outside of the bar 
          y = percentage + (max(percentage) / 25)), 
      color = "#4C4C4C", 
      size = 2.5, 
      family = "Theinhardt", 
      hjust = 0) + 
    coord_flip() +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", 
         y = " ") +
    facet_wrap(~facet_text) +
    get_datastory_theme()
  
}

# plot_type3: barplot displaying proportion of amount awarded per selected category 
plot_type3 <- function(data, cat_var, facet_text,
                       y_max, upper_break, break_length){
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    mutate(facet_text = facet_text) %>%
    ggplot(aes(x = selected_category, 
               y = percentage)) + 
    # choose the color
    geom_col(fill = get_datastory_scheme()[1]) + 
    geom_text(
      # get the percentage plus the number of cases printed as a label
      aes(label = if_else(percentage > 0, 
                          paste0(round(percentage * 100, digits = 0), "%",
                                 "\n", print_num(
                                   round(TotalAmount / 1000000, digits = 0)),
                                 " MCHF"), ""),
          # print the label outside of the bar 
          y = percentage + (max(percentage) / 25)), 
      color = "#4C4C4C", 
      size = 2.5, 
      family = "Theinhardt", 
      hjust = 0) + 
    coord_flip() +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", 
         y = "") +
    facet_wrap(~facet_text) +
    get_datastory_theme()
  
  
}

# plot_type4: lineplot displaying proportion of approved amounts or number of 
# grants with relation to SDGs

plot_type4 <- function(data, cat_var, facet_text,
                       y_max, upper_break, break_length){
  data %>%
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    mutate(facet_text = facet_text) %>%
    ggplot(aes(x = CallDecisionYear, 
               y = percentage, 
               group = selected_category,
               color = selected_category,
               # Define tooltip text for ggiraph
               tooltip = paste0(
                 translate(
                   "Research area: ",
                   "Fachbereich: ",
                   "Domaine de recherche : ",
                   lang
                 ),
                 selected_category, "<br>",
                 translate(
                   "Percentage: ",
                   "Anteil: ",
                   "Part : ",
                   lang
                 ),
                 paste0(round(percentage * 100, 0), "%"), "<br>",
                 translate(
                   "Year: ",
                   "Jahr: ",
                   "Année : ",
                   lang
                 ),
                 CallDecisionYear, "<br>"),
               data_id = rownames(data))) + 
    geom_line(size = 0.5) +
    geom_point_interactive(shape = 16, size = 2) +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", 
         y = "") +
    # set the color scheme for the different sdgs
    scale_colour_manual(values = get_datastory_scheme()) +
    facet_wrap(~facet_text) +
    get_datastory_theme(gridline_axis = "y")
  
}

# plot_type5: stacked barplot displaying proportion of SDGs grants 
# per selected category 
plot_type5 <- function(data, cat_var, label_y_axis, y_min,
                       y_max, upper_break, break_length){
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    ggplot(aes(x = "", 
               y = percentage,
               fill = fct_rev(selected_category))) + 
    geom_col(color = "white") + 
    # get the percentage plus the number of cases printed as a label
    geom_text(aes(label = paste0(round(percentage * 100, digits = 0), "%",
                                 "\n", "n = ", n)),
              # we want the label to be printed in the bar itself
              position = position_stack(vjust = 0.5), 
              color = "white",
              size = 2.5,
              family = "Theinhardt") +
    coord_flip() + 
    get_datastory_theme()  +
    # define the values we want the colors to have
    scale_fill_manual(values = rev(get_datastory_scheme(n_col = 2)),
                      guide = guide_legend(reverse = TRUE)) +
    labs(x = NULL, y = NULL,
         caption = label_y_axis) +
    # set up of the axis displaying the percentages
    scale_y_continuous(limits = c(y_min, y_max), expand = c(0, 0), 
                       breaks = seq(0, upper_break, break_length), 
                       labels = percent_format(accuracy = 1)) +
    # adjust the labels of the x-axis such that they don't overlap
    theme(plot.caption.position = "panel",
          plot.caption = element_text(hjust = 0)) 
}

# function to identify different discipline combinations
identify_disc_combinations <- function(data, first_disc_var, second_disc_var){
  
  data %>%
    rename(first_disc := first_disc_var,
           second_disc := second_disc_var) %>% 
    # get rid of cases where we have an NA
    filter(!is.na(first_disc),
           !is.na(second_disc)) %>%
    # always have the lower discipline as the first discipline
    mutate(first_disc_new = case_when(
      first_disc > second_disc ~ second_disc,
      first_disc < second_disc ~ first_disc),
      second_disc_new = case_when(
        first_disc > second_disc ~ first_disc,
        first_disc < second_disc ~ second_disc),
      # combine the two disciplines into one column with the lower
      # discipline first
      disc_comb = paste(first_disc_new, sep = ", ", second_disc_new)) %>%
    # only keep the number plus the combined disciplines
    select(Number, disc_comb)
  
}


```


<!-- Short lead (2-3 sentences) in bold -->

**In einer explorativen Analyse hat der SNF untersucht, inwiefern die von ihm geförderten Projekte einen Bezug zu den Zielen der nachhaltigen Entwicklung der Vereinten Nationen haben. Es lassen sich in allen Fachbereichen Bezüge zu den Nachhaltigkeitszielen finden. Nun soll eine Befragung von Forschenden weitere Erkenntnisse liefern.**

Mit den 17 Zielen für nachhaltige Entwicklung der Vereinten Nationen (Sustainable Development Goals, SDGs) soll das menschliche Wohlergehen auf gerechte Weise gefördert werden, sodass niemand zurückgelassen und das natürliche System geschützt wird. Der Forschung kommt dabei eine wichtige Rolle zu: Sie schafft neues Wissen und damit die Grundlage für technologische und soziale Innovation. Damit leistet sie einen Beitrag zum gesellschaftlichen und politischen Diskurs über gemeinsames Handeln und Umdenken.

Mithilfe von zwei Klassifizierungsinstrumenten haben wir eine explorative Analyse durchgeführt, um herauszufinden, inwiefern sich SNF-Projekte auf die Nachhaltigkeitsziele beziehen. Obwohl die Klassifizierungsinstrumente noch nicht vollständig ausgereift sind (siehe Box "Methode und ihre Grenzen"), geben die Resultate erste Einblicke in die vom SNF finanzierte Forschung zu den SDGs.

<div class="info-box">

### Methode und ihre Grenzen

<p>Für diese Analyse haben wir eine Reihe verschiedener, SDG-Klassifizierungsinstrumente geprüft: den SDG-Klassifikator von Dimensions, sowie die Abfragesysteme, die über das öffentlich zugängliche <a href="https://www.r-project.org/about.html" target="_blank">R-Paket</a> <a href="https://github.com/dwulff/text2sdg#readme" target="_blank">text2sdg</a> verfügbar sind (Aurora, Elsevier, OSDG, SDSN und SIRIS). Alle diese Instrumente wurden mit den Titeln, Abstracts und Keywords der bewilligten Gesuche gespiesen. Von den Ergebnissen der verschiedenen Instrumente haben wir eine Zufallsstichprobe manuell ausgewertet. Dazu haben wir identifiziert, auf welche SDGs sich die Projekte aus unserer Sicht beziehen und diese Einschätzung mit den von den verschiedenen Instrumenten erzeugten Ergebnissen verglichen. Damit identifizierten wir jene Instrumente, welche die "korrekten" SDGs erkannten und die wenigsten falsch-positiven Ergebnisse lieferten. Als falsch-positiv wird ein Fall bezeichnet, bei dem das Klassifizierungsinstrument einen Bezug zu einem bestimmten SDG identifiziert, der in der Realität nicht besteht. So kamen wir zum Schluss, dass die Instrumente von Dimensions und Elsevier mit den SNF-Daten die besten Resultate erzielen. Im Folgenden werden die Ansätze von Dimensions und Elsevier kurz erläutert.</p>

<p><u>Dimensions</u><br/>
Der Dimensions-Klassifikator wurde von Digital Science entwickelt und basiert auf maschinellem Lernen. Mithilfe von <a href="https://www.dimensions.ai/" target="_blank">Dimensions</a>, dem grössten Datensatz an verknüpften Forschungsinformationen (Publikationen, Fördermittel, Forschungsdaten etc.), <a href="https://digitalscience.figshare.com/ndownloader/files/22574228" target="_blank">erstellte Digital Science aus dem kompletten Satz der 17 SDGs ein Modell aus umfangreichen und spezifischen Suchanfragen</a>. Daraus wurden 17 Trainingssätze an Publikationen aus der Dimensions-Datenbank generiert (einer für jedes SDG) und mithilfe von Computerlinguistik ein SDG-Klassifizierungsschema erstellt. Um die Qualität der Trainingssätze zu verbessern, wurde regelmässig überprüft, ob die identifizierten Publikationen der Beschreibung der SDG-Definition entsprechen. Der Dimensions-Klassifikator verwendet in einigen seiner Suchanfragen auch eine Umkreissuche (sogenannte Proximity Search), sodass Sätze, die bestimmte verwandte Wörter enthalten, ebenfalls gefunden werden können.^[Wastl J, Hook DW, Fane B, Draux H, Porter SJ. 2020. Contextualizing Sustainable Development Research. Using Dimensions to explore the global landscape of research on Sustainable Development Goals. Digital Science. Report. <a href="https://doi.org/10.6084/m9.figshare.12200081.v2" target="_blank">https://doi.org/10.6084/m9.figshare.12200081.v2</a>]</p>

<p><u>Elsevier</u><br/>
Auch das Data-Science-Team von Elsevier hat <a href="https://elsevier.digitalcommonsdata.com/datasets/87txkw7khs/1" target="_blank">Suchanfragen für SDGs entwickelt</a>. Diese basieren auf <a href="https://www.scopus.com/" target="_blank">Scopus</a>, der bibliographischen Datenbank zu wissenschaftlicher Literatur von Elsevier. 
Gemeinsam mit Fachexperten wurde eine erste Scopus-Suchanfrage für jedes SDG entwickelt. Dies führte zu einer kuratierten Liste an Publikationen, die einen Bezug zu den SDGs aufweisen. Der Prozess der Verfeinerung der Suchanfragen zu den einzelnen SDGs ist noch nicht abgeschlossen. Elsevier berücksichtigt Kundenfeedback, um die Anzahl der Suchbegriffe zu erhöhen, welche zur Definition der einzelnen SDGs verwendet werden. In einer neueren Version aus den Jahren 2021/2022 wurden die Abfragen zudem durch ein Machine Learning-Modell ergänzt. Für die Analysen in dieser Datengeschichte haben wir die Originalversion von 2019 verwendet. Elsevier berücksichtigt in seinem Klassifizierungsinstrument das SDG 17 (Globale Partnerschaften für die Ziele) nicht. Da wir nur jene Fälle berücksichtigen, in denen beide Klassifizierungsinstrumente das gleiche SDG identifizieren (siehe die Beschreibung des Ansatzes im nächsten Abschnitt), wird dieses SDG in unserer Analyse nicht berücksichtigt.
</p>

<p><b>Beschränkungen</b><br/>
Die automatisierte Identifizierung von Bezügen zu den SDGs mithilfe von Klassifizierungsinstrumenten hat derzeit noch ihre Grenzen. Einerseits werden nicht alle Bezüge zu den SDGs richtig erkannt. Andererseits werden zum Teil Bezüge zu SDGs identifiziert, wo es gar keine gibt. Darüber hinaus begünstigen die Instrumente meist eines oder mehrere der SDGs und überschätzen deren Häufigkeit. Die Qualität der Klassifizierungsinstrumente lässt sich zudem nicht abschliessend beurteilen, da es derzeit nur sehr wenige ausreichend grosse Validierungsdatensätze gibt.^[Wulff DU, Meier DS, Mata R. 2023. Using novel data and ensemble models to improve automated labeling of Sustainable Development Goals. Preprint: <a href="https://arxiv.org/pdf/2301.11353.pdf" target="_blank">https://arxiv.org/pdf/2301.11353.pdf</a>]<br/><br/>
Aus diesem Grund haben wir uns für einen vorsichtigen Ansatz entschieden: Wir haben die Resultate der beiden Klassifizierungsinstrumente von Dimensions und Elsevier verglichen und einen SDG-Bezug nur dann als gültig betrachtet, wenn er von beiden Instrumenten erkannt wurde. Diese Methode sollte zu einer angemessenen unteren Grenze führen, mit der im Laufe der Zeit Trends erkannt werden können und das Problem der falsch-positiven Ergebnisse verringert wird. Die Methoden und Ergebnisse sind experimentell. Wir sind trotzdem der Meinung, dass sie interessant sind, da beide Instrumente dasselbe zu messen versuchen, auf ähnlichen Ansätzen beruhen und vergleichbare Ergebnisse liefern.<br/><br/>
In der Zwischenzeit haben die Autoren des R-Pakets text2sdg ein "<a href="https://arxiv.org/pdf/2301.11353.pdf" target="_blank">Ensemble-Tool</a>" entwickelt, das die einzelnen Klassifizierungsinstrumente zusammenführt. Dieses hat das Potenzial, unseren Ansatz zu übertreffen. Wir begrüssen dies und werden die Entwicklungen in diesem Bereich im Auge behalten.</p>

<div class="plot-box">

<div class="plot-title">Vergleich der beiden Klassifizierungsinstrumente - die Abbildung zeigt den Anteil der bewilligten Projekte 2016-2021 mit einem Bezug zu einem SDG</div>

```{r comparison-of-classifiers, out.width="100%", fig.height=6}
# Visualize this data 
plot_data <- sdg_mentions_all %>%
  mutate(
    sdg_result_fr =
      fct_recode(
        sdg_result_fr,
        "01 Pas de pauvreté" = "01 Éradication de la pauvreté",
        "02 Faim « zéro »" = "02 Lutte contre la faim",
        "03 Bonne santé et bien-être" = "03 Accès à la santé",
        "04 Éducation de qualité" = "04 Accès à une éducation de qualité",
        "06 Eau propre et assainissement" = "06 Accès à l'eau salubre et à l'assainissement",
        "07 Énergie propre et d'un coût abordable" = "07 Recours aux énergies renouvelables",
        "08 Travail décent et croissance économique" = "08 Accès à des emplois décents",
        "10 Inégalités réduites" = "10 Réduction des inégalités",
        "13 Mesures relatives à la lutte contre les changements climatiques" = "13 Lutte contre le changement climatique",
        "16 Paix, justice et institutions efficaces" = "16 Justice et paix"
      ),
    sdg_result_de =
      fct_recode(
        sdg_result_de,
        "05 Geschlechter-Gleichheit" = "05 Geschlechter-Gleichstellung",
      )
  ) |>
  filter(!str_starts(sdg_result, "17 ")) %>%
  rename("in beiden gefunden" = freq_both, 
         Dimensions = freq_dim, 
         Elsevier = freq_elsevier) %>% 
  # transform it into long format 
  pivot_longer(
    cols = c("in beiden gefunden", Dimensions, Elsevier),
    names_to = "Classifier", 
    values_to = "percentage") %>% 
  mutate(
    sdg_result = fct_relabel(sdg_result, ~ str_wrap(.x, width = 30)),
    sdg_result_de = fct_relabel(sdg_result_de, ~ str_wrap(.x, width = 30)),
    sdg_result_fr = fct_relabel(sdg_result_fr, ~ str_wrap(.x, width = 30)),
    sdg_result = fct_rev(sdg_result),
    sdg_result_de = fct_rev(sdg_result_de),
    sdg_result_fr = fct_rev(sdg_result_fr),
    Classifier =
      recode(
        Classifier,
        "in beiden gefunden" = translate(
          "Found in both",
          "in beiden gefunden",
          "Recoupement\nDimensions/Elsevier",
          lang
        )
      )
  ) 

# make the plot using the plot_type1 function
plot_type1(data = plot_data,
           facet_var = "Classifier",
           result_var = paste0("sdg_result", translate("", "_de", "_fr", lang)),
           y_max = 0.22, upper_break = 0.2, break_length = 0.05,
           sdg_color_scheme = sdg_16_colors)

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>


### Alle Fachbereiche forschen zu den Zielen für nachhaltige Entwicklung

Insgesamt fand das kombinierte Klassifizierungssystem bei 1'489 von insgesamt 12'431 Projekten seit 2016 (12%) einen Bezug zu einem oder mehreren SDGs (siehe Box Daten). Diese Projekte wurden mit insgesamt 709 Millionen Franken unterstützt, was 13% der zugesprochenen Mittel entspricht. Ein Bezug zu mehr als einem SDG konnte nur in wenigen Fällen identifiziert werden: In 70 Projekten (0,6%) wurden zwei SDGs identifiziert und lediglich in zwei Projekten wurde ein Bezug zu drei SDGs erkannt.

```{r analyse-how-many-grants-are-related-to-SDGs-overall}

# How many grants have reference to SDGs
plot_data_1 <- data_grants_w_sdg %>%
  mutate(
    is_sdg_fr =
      recode(
        is_sdg_fr,
        `Pas de lien avec SDG` = "Aucun lien avec les ODD",
        `Lien avec SDG` = "Lien avec les ODD"
      ),
    is_sdg =
      recode(
        is_sdg,
        `No SDG reference` = "No link to SDGs",
        `SDG reference` = "Link to SDGs"
      ),
  ) %>%
  # count how many times we identified SDGs 
  count(
    .data[[
      paste0("is_sdg", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # calculate percentage to get an idea of the relations
  mutate(percentage = round((n / sum(n)), digits = 4))

# How much money went to projects related to SDGs
plot_data_2 <- data_grants_w_sdg %>% 
  mutate(
    is_sdg_fr =
      recode(
        is_sdg_fr,
        `Pas de lien avec SDG` = "Aucun lien avec les ODD",
        `Lien avec SDG` = "Lien avec les ODD"
      ),
    is_sdg =
      recode(
        is_sdg,
        `No SDG reference` = "No link to SDGs",
        `SDG reference` = "Link to SDGs"
      ),
  ) %>%
  # Group by is_sdg
  group_by(
    .data[[
      paste0("is_sdg", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # summarise the awarded money per is sdg or not
  summarise(TotalAmount = sum(AmountGranted)) %>% 
  mutate(percentage = 
           round(TotalAmount / sum(TotalAmount), digits = 3))
```


<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Bewilligte Projekte 2016-2021, bei denen ein Bezug zu einem oder mehreren SDGs identifiziert wurde (Anteil der Projekte und Anteil des bewilligten Betrags)</div>

```{r plot-2-desk, out.width="100%", fig.height=2}

# And make the plot 1
plot_type2(data = plot_data_1,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of grants",
               "Anteil der Projekte",
               "Part des projets approuvés",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2) 

# And make the plot 2
plot_type3(data = plot_data_2,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of approved funding",
               "Anteil des bewilligten Betrags",
               "Part du montant accordé",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2)

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Bewilligte Projekte 2016-2021, bei denen ein Bezug zu einem oder mehreren SDGs identifiziert wurde (Anteil der Projekte und Anteil des bewilligten Betrags)</div>

```{r plot-2-phone, out.width="100%", fig.height=2}

# And make the plot 1
plot_type2(data = plot_data_1,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of grants",
               "Anteil der Projekte",
               "Part des projets approuvés",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2) 

# And make the plot 2
plot_type3(data = plot_data_2,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of approved funding",
               "Anteil des bewilligten Betrags",
               "Part du montant accordé",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2)

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

Insgesamt lässt sich seit 2016 ein leichter Aufwärtstrend beobachten: Dem Klassifizierungssystem zufolge gibt es zunehmend mehr Projekte mit einem Bezug zu den SDGs und damit auch mehr finanzielle Mittel, die für die entsprechende Forschung verwendet werden. Zwischen den Fachbereichen (Geistes- und Sozialwissenschaften: GSW, Mathematik, Informatik, Naturwissenschaft und Technik: MINT und Lebenswissenschaften: LW) gibt es keine grossen Unterschiede.

```{r analyse-how-many-grants-are-related-to-SDGs-over-time}

# how does it evolve over time - do we observe more mentions in recent years
# looking at number of grants
plot_data <- data_grants_w_sdg %>%
  group_by(
    CallDecisionYear,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # count how many times we have a mention of at least one SDG
  count(is_sdg) %>% 
  # calculate percentage to get an idea of the relations
  mutate(percentage = (n / sum(n))) %>% 
  filter(
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
    !=
      translate(
        "Interdisciplinary",
        "Interdisziplinär",
        "Interdisciplinaire",
        lang
      )
  ) %>% 
  # only keep the rows indicating how many grants had a relation to SDGs 
  filter(is_sdg == "SDG reference")

# make the plot
p_n_sdg_projects_disc <-
  plot_type4(
    data = plot_data,
    cat_var = paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang)), 
    facet_text =
      translate(
        "Percentage of grants",
        "Anteil der Projekte",
        "Part des projets approuvés",
        lang
      ),
    y_max = 0.2,
    upper_break = 0.2,
    break_length = 0.05
  )


# Create ggiraph object
girafe_n_sdg_projects_disc <- girafe(
  ggobj = p_n_sdg_projects_disc,
  height_svg = 3.5,
  options = list(
    opts_toolbar(saveaspng = FALSE),
    opts_hover(css = "fill:#F08262;stroke:#F08262;stroke-width:2"),
    opts_tooltip(
      css = get_ggiraph_tooltip_css(),
      opacity = 0.8,
      delay_mouseover = 0,
      delay_mouseout = 0
    )
  )
)


# how does it evolve over time - do we observe more mentions in recent years
# looking at approved amounts
plot_data <- data_grants_w_sdg %>% 
  group_by(
    is_sdg,
    CallDecisionYear,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # summarise the awarded money per is sdg or not
  summarise(TotalAmount = sum(AmountGranted)) %>% 
  group_by(
    CallDecisionYear,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  mutate(percentage = 
           round(TotalAmount / sum(TotalAmount), digits = 3)) %>% 
  filter(
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]] !=
      translate(
        "Interdisciplinary",
        "Interdisziplinär",
        "Interdisciplinaire",
        lang
      )
  ) %>% 
  # only keep the rows indicating how many grants had a relation to SDGs 
  filter(is_sdg == "SDG reference") 

# make the plot
p_amount_sdg_projects_disc <-
  plot_type4(
    data = plot_data,
    cat_var = paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang)), 
    facet_text =
      translate(
        "Percentage of approved funding",
        "Anteil des bewilligten Betrags",
        "Part du montant accordé",
        lang
      ),
    y_max = 0.2,
    upper_break = 0.2,
    break_length = 0.05
  )

# Create ggiraph object
girafe_amount_sdg_projects_disc <- girafe(
  ggobj = p_amount_sdg_projects_disc,
  height_svg = 3.5,
  options = list(
    opts_toolbar(saveaspng = FALSE),
    opts_hover(css = "fill:#F08262;stroke:#F08262;stroke-width:2"),
    opts_tooltip(
      css = get_ggiraph_tooltip_css(),
      opacity = 0.8,
      delay_mouseover = 0,
      delay_mouseout = 0
    )
  )
)

```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Entwicklung des Anteils der Projekte, bei denen ein Bezug zu einem oder mehreren SDGs identifiziert wurde (Anteil der Projekte und Anteil des bewilligten Betrags)</div>

```{r plot-3-desk, out.width="100%", fig.height=3}

girafe_n_sdg_projects_disc

girafe_amount_sdg_projects_disc

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Entwicklung des Anteils der Projekte, bei denen ein Bezug zu einem oder mehreren SDGs identifiziert wurde (Anteil der Projekte und Anteil des bewilligten Betrags)</div>

```{r plot-3-phone, out.width="100%", fig.height=3}

girafe_n_sdg_projects_disc

girafe_amount_sdg_projects_disc

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

### Am meisten Forschung zu Klimaschutz und Gesundheit

Mit dem Klassifizierungssystem konnten wir feststellen, zu welchen SDGs die SNF-Projekte einen Bezug aufweisen. Am häufigsten wurden Bezüge zu den folgenden sechs SDGs identifiziert:

-	SDG 13: Massnahmen zum Klimaschutz (3,1% aller analysierten Projekte)
-	SDG 3: Gesundheit und Wohlergehen (3,1 %)
-	SDG 7: Bezahlbare und saubere Energie (1,9%)
-	SDG 16: Frieden, Gerechtigkeit und starke Institutionen (1,7 %)
-	SDG 10: Weniger Ungleichheiten (0,5%)
-	SDG 11: Nachhaltige Städte und Gemeinden (0,4%)

```{r analyse-distribution-across-sdgs-overall}

# Look at what sdgs are most often found in the approved grants only
sdg_grants_data <- sdg_mentions_all %>% 
  filter(sdg_result != "17 Partnerships for the Goals") %>% 
  select(sdg_result, freq_both, n_both) %>% 
  mutate(
    my_color = sdg_16_colors,
    sdg_result_short = str_sub(sdg_result, 1, 2),
    sdg_result_short =
      str_glue("{translate('SDG', 'SDG', 'ODD', lang)} {sdg_result_short}"),
    sdg_result = fct_reorder(sdg_result, n_both),
    sdg_n = glue::glue("{sdg_result_short}\n n = {n_both}")
  ) 
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Anzahl der von 2016-2021 bewilligten Projekte pro SDG</div>

```{r plot-4-desk, out.width="100%", fig.height=3.5}
# make the plot
sdg_grants_data %>%
  ggplot(aes(area = n_both, fill = my_color, label = sdg_n)) + 
  geom_treemap(start = "bottomleft") +
  geom_treemap_text(fontface = "italic", colour = "white",
                    place = "center", grow = FALSE,
                    family = "Theinhardt",
                    start = "bottomleft")+
  scale_fill_identity(
    guide = "legend",
    breaks = plot_data$my_color,
    label = plot_data$sdg_result) +
  get_datastory_theme() +
  # get legend on two rows
  guides(fill = guide_legend(nrow = 6, byrow = TRUE))

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Anzahl der von 2016-2021 bewilligten Projekte pro SDG</div>

```{r plot-4-phone, out.width="100%", fig.height=3.5}
# make the plot
sdg_grants_data %>%
  ggplot(aes(area = n_both, fill = my_color, label = sdg_n)) + 
  geom_treemap(start = "bottomleft") +
  geom_treemap_text(fontface = "italic", colour = "white",
                    place = "center", grow = FALSE,
                    family = "Theinhardt",
                    start = "bottomleft")+
  scale_fill_identity(
    guide = "legend",
    breaks = plot_data$my_color,
    label = plot_data$sdg_result) +
  get_datastory_theme() +
  # get legend on two rows
  guides(fill = guide_legend(nrow = 6, byrow = TRUE))

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

Welche Forschungsbereiche widmen sich diesen SDGs? Bei den Top-3-SDGs scheint es jeweils einen "dominanten" Forschungsbereich zu geben, aber auch die beiden anderen Forschungsbereiche tragen zur Erforschung der jeweiligen Themen bei. Um SDG 16 (Frieden, Gerechtigkeit und starke Institutionen) und SDG 10 (Weniger Ungleichheiten) scheinen sich ziemlich exklusiv die Geistes- und Sozialwissenschaften zu kümmern. SDG 11 (Nachhaltige Städte und Gemeinden) wurde dagegen zu ähnlichen Teilen von den Geistes- und Sozialwissenschaften (GSW) und den Disziplinen im Bereich MINT (Mathematik, Informatik, Naturwissenschaften und Technik) erforscht, wobei die Lebenswissenschaften (LW) ebenfalls eine kleine Rolle spielen.

```{r analyse-contribution-research-areas-top-SDGs}
# Create vector containing the top-6 sdgs
top_6_sdg <- sdg_mentions_all %>%
  slice_max(n_both, n = 6) %>% 
  mutate(sdg_result_short = str_sub(sdg_result, 1, 2)) %>%  
  mutate(
    sdg_result_short =
      paste0(translate('SDG ', 'SDG ', 'ODD ', lang), sdg_result_short)
  ) %>% 
  pull(sdg_result_short)

plot_data <- data_sdgs %>% 
  mutate(
    sdg_result = paste0(translate('SDG ', 'SDG ', 'ODD ', lang), sdg_result)
  ) %>% 
  filter(sdg_result %in% top_6_sdg,
         MainDisciplineLevel1 != "Interdisciplinary") %>% 
  group_by(
    sdg_result,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  count(sdg_result) %>% 
  group_by(sdg_result) %>% 
  # calculate percentage to get an idea of the relations
  mutate(percentage = round((n / sum(n)), digits = 4)) %>% 
  ungroup() %>% 
  mutate(sdg_result = as_factor(sdg_result),
         sdg_result = fct_rev(fct_relevel(sdg_result, top_6_sdg)))
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Beitrag der drei Forschungsbereiche zu den Top-6-SDGs</div>

```{r plot-5-desk, out.width="100%", fig.height=3.5}
plot_data %>% 
  ggplot(
    aes(x = sdg_result, 
        y = percentage,
        fill =
          fct_rev(
            .data[[
              paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
            ]]
          )
    )) + 
  geom_col(color = "white") +
  # get the percentage plus the number of cases printed as a label
  geom_text(aes(label = if_else(percentage > 0.05, 
                                paste0(round(percentage * 100, digits = 0), "%",
                                       "\n", "n = ", n),
                                # if percentage is very small do not print label
                                "")),
            # we want the label to be printed in the bar itself
            position = position_stack(vjust = 0.5), 
            color = "white",
            size = 3,
            family = "Theinhardt") +
  coord_flip() + 
  # put legend to the bottom
  get_datastory_theme() +
  # define the values we want the colors to have
  scale_fill_manual(values = rev(get_datastory_scheme(n_col = 3)),
                    guide = guide_legend(reverse = TRUE)) +
  # set up of the axis displaying the percentages
  scale_y_continuous(limits = c(0, 1.05), expand = c(0, 0), 
                     breaks = seq(0, 1, 0.25), 
                     labels = percent_format(accuracy = 1)) +
  labs(x = NULL, y = NULL)  +
  theme(plot.caption.position = "panel",
        plot.caption = element_text(hjust = 0))
```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Beitrag der drei Forschungsbereiche zu den Top-6-SDGs</div>

```{r plot-5-phone, out.width="100%", fig.height=3.5}
plot_data %>% 
  ggplot(
    aes(x = sdg_result, 
        y = percentage,
        fill =
          fct_rev(
            .data[[
              paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
            ]]
          )
    )) + 
  geom_col(color = "white") +
  # get the percentage plus the number of cases printed as a label
  geom_text(aes(label = if_else(percentage > 0.05, 
                                paste0(round(percentage * 100, digits = 0), "%",
                                       "\n", "n = ", n),
                                # if percentage is very small do not print label
                                "")),
            # we want the label to be printed in the bar itself
            position = position_stack(vjust = 0.5), 
            color = "white",
            size = 3,
            family = "Theinhardt") +
  coord_flip() + 
  # put legend to the bottom
  get_datastory_theme() +
  # define the values we want the colors to have
  scale_fill_manual(values = rev(get_datastory_scheme(n_col = 3)),
                    guide = guide_legend(reverse = TRUE)) +
  # set up of the axis displaying the percentages
  scale_y_continuous(limits = c(0, 1.05), expand = c(0, 0), 
                     breaks = seq(0, 1, 0.25), 
                     labels = percent_format(accuracy = 1)) +
  labs(x = NULL, y = NULL)  +
  theme(plot.caption.position = "panel",
        plot.caption = element_text(hjust = 0))
```

<div class="caption">
Daten: bewilligte Projekte 2016-2021.
</div>
</div>
</div>

### Forschung zu bezahlbarer und sauberer Energie: mehrere Disziplinen beteiligt

Im Folgenden betrachten wir das sehr aktuelle SDG 7 (Bezahlbare und saubere Energie) genauer. 240 und somit 1,9% aller analysierten Projekte weisen laut dem Klassifizierungssystem einen Bezug zu diesem SDG auf. Damit verbunden sind finanzielle Mittel in der Höhe von 108 Millionen Franken.

In knapp der Hälfte dieser Projekte (44%) sind mehrere Disziplinen beteiligt. Dies ist auch bei den anderen SDGs zu beobachten: An fast der Hälfte der Projekte (47%), für die ein Bezug zu einem SDG identifiziert wurde, sind mehrere Disziplinen beteiligt. Der Anteil derartiger Projekte an allen vom SNF geförderten Projekte beträgt dagegen nur 41%. Diese Erkenntnis stärkt die <a href="https://www.nature.com/articles/525315a" target="_blank">These</a>, wonach sich disziplinenübergreifende Zusammenarbeit zur Behandlung globaler Herausforderungen besonders gut eignet: Komplexe Fragestellungen erfordern Zusammenarbeit, Konsensbildung, Validierung, gegenseitige Befruchtung von Ideen und effektive Kommunikation über wissenschaftliche Disziplinen hinweg.

```{r analyse-SDG07-according-to-number-of-disciplines, out.width="100%", fig.height=1.5}
# Calculate what proportion of all grants with sdg reference had more than
# one discipline
plot_data <- data_sdgs %>% 
  filter(sdg_result == "07") %>%
  mutate(
    is_interdisciplinary_cat_de =
      fct_relevel(is_interdisciplinary_cat_de, "Eine Disziplin"),
    is_interdisciplinary_cat =
      fct_relevel(is_interdisciplinary_cat, "One discipline"),
    is_interdisciplinary_cat_fr =
      fct_relevel(is_interdisciplinary_cat_fr, "Une discipline")
  ) %>%
  distinct(Number, .keep_all = TRUE) %>% 
  group_by(
    .data[[
      paste0("is_interdisciplinary_cat", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percentage = n / sum(n)) 
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Anzahl beteiligter Disziplinen in Projekten, bei denen ein Bezug zu SDG 7 (Bezahlbare und saubere Energie) identifiziert wurde</div>

```{r plot-6-desk, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_interdisciplinary_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)
```

<div class="caption">
Daten: bewilligte Projekte 2016-2021 mit Bezug zu SDG 7.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Anzahl beteiligter Disziplinen in Projekten, bei denen ein Bezug zu SDG 7 (Bezahlbare und saubere Energie) identifiziert wurde</div>

```{r plot-6-phone, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_interdisciplinary_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)
```

<div class="caption">
Daten: bewilligte Projekte 2016-2021 mit Bezug zu SDG 7.
</div>
</div>
</div>


```{r identify-which-disciplines-come-together-most-often}

# using the function to identif discpline combinations, we use this to identify
# these combinations on all possible pairings of two disciplines for a given
# grant -> this step has to be repeated several times 
disc_1_2 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc2"
)

disc_1_3 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc3"
)

disc_1_4 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc4"
)

disc_1_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc5"
)

disc_1_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc6"
)

disc_2_3 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc3"
)

disc_2_4 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc4"
)

disc_2_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc5"
)

disc_2_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc6"
)

disc_3_4 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc3",
  second_disc_var = "disc4"
)

disc_3_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc3",
  second_disc_var = "disc5"
)

disc_3_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc3",
  second_disc_var = "disc6"
)

disc_4_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc4",
  second_disc_var = "disc5"
)

disc_4_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc4",
  second_disc_var = "disc6"
)

disc_5_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc5",
  second_disc_var = "disc6"
)

# now combine all of these datasets together by putting them underneath each
# other
disc_comb_sdg07 <- bind_rows(disc_1_2, disc_1_3, disc_1_4, disc_1_5, disc_1_6,
                             disc_2_3, disc_2_4, disc_2_5, disc_2_6,
                             disc_3_4, disc_3_5, disc_3_6,
                             disc_4_5, disc_4_6,
                             disc_5_6)

# get number of interdisciplinary grants that are related to sdg 07 overall
n_interdis_grants_sdg7 <- data_sdg07_disciplines %>% 
  count() %>% 
  pull()

# make table where we see 
n_disc_comb_sdg07 <- disc_comb_sdg07 %>% 
  ungroup() %>% 
  count(disc_comb) %>% 
  arrange(desc(n)) %>% 
  mutate(percentage = round((n / n_interdis_grants_sdg7) *100 , digits = 0))

```


In den Projekten mit einem Bezug zum SDG 7 finden wir am häufigsten die Kombination folgender Fachgebiete:

- Chemie und Ingenieurwissenschaften (`r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20500") %>% pull(n)` Projekte, `r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20500") %>% pull(percentage)`%)
- Physik und Ingenieurwissenschaften (`r n_disc_comb_sdg07 %>% filter(disc_comb == "20400, 20500") %>% pull(n)` Projekte, `r n_disc_comb_sdg07 %>% filter(disc_comb == "20400, 20500") %>% pull(percentage)`%)
- Chemie und Physik (`r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20400") %>% pull(n)` Projekte, `r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20400") %>% pull(percentage)`%)

Dabei arbeiten auch häufig zwei oder mehr Gesuchstellerinnen und Gesuchsteller zusammen. So sind 23% der Projekte im Zusammenhang mit SDG 7 kollaborativ. Diesen Anteil finden wir über alle Projekte mit einem SDG-Bezug hinweg (23%). Über alle untersuchten Projekte hinweg liegt der Anteil kollaborativer Projekte hingegen bei nur 19%.

```{r analyse-SDG07-according-to-degree-of-collaboration, out.width="100%", fig.height=1.5}
# Calculate what proportion of all grants with sdg reference had more than
# one discipline
plot_data <- data_sdgs %>% 
  filter(sdg_result == "07") %>% 
  distinct(Number, .keep_all = TRUE) %>%
  mutate(
    is_collaborative_cat_de =
      fct_relevel(
        recode(
          is_collaborative_cat_de,
          Kollaborativ = "Mehr als eine gesuchstellende Person",
          `Nicht kollaborativ` = "Eine gesuchstellende Person"
        ),
        "Eine gesuchstellende Person"
      ),
    is_collaborative_cat =
      fct_relevel(
        recode(
          is_collaborative_cat,
          Collaborative = "More than one applicant",
          `Non-collaborative` = "One applicant"
        ),
        "One applicant"
      ),
    is_collaborative_cat_fr =
      fct_relevel(
        recode(
          is_collaborative_cat_fr,
          Collaboratif = "Plusieurs requérant·es",
          `Non collaboratif` = "Un·e requérant·e"
        ),
        "Un·e requérant·e"
      )
  ) %>%
  group_by(
    .data[[
      paste0("is_collaborative_cat", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percentage = n / sum(n)) 
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Grad der Zusammenarbeit in Projekten, bei denen ein Bezug zu SDG 7 (Bezahlbare und saubere Energie) identifiziert wurde</div>

```{r plot-7-desk, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_collaborative_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021 mit Bezug zu SDG 7.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Grad der Zusammenarbeit in Projekten, bei denen ein Bezug zu SDG 7 (Bezahlbare und saubere Energie) identifiziert wurde</div>

```{r plot-7-phone, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_collaborative_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)

```

<div class="caption">
Daten: bewilligte Projekte 2016-2021 mit Bezug zu SDG 7.
</div>
</div>
</div>

```{r analyse-the-type-of-collaborations}

# get the number of collaborative projects (in SDG 07)
n_collab_projects_sdg07 <- data_sdgs %>% 
  filter(sdg_result == "07",
         is_collaborative == 1) %>%
  count() %>% 
  pull()

# get the number of applicants involved in collaborative projects (with 
# reference to SDG 07)
n_applicants_collab_sdg07 <- data_sdgs %>% 
  filter(sdg_result == "07",
         is_collaborative == 1) %>%
  summarise(total_applicants = sum(n_applicants)) %>% 
  pull()

# identify the cases where collaboration was international
international_collabrations_sdg07 <- data_sdg07_collaborations %>% 
  filter(Institution2 == "International") %>%
  # only count this type of collaboration once per project, as we are now 
  # interested in knowing how many projects of the 55 have this form of 
  # collaboration
  distinct(Number, .keep_all = TRUE) %>% 
  count() %>% 
  pull()
```


An den `r n_collab_projects_sdg07` kollaborativen SDG-7-Projekten sind insgesamt `r n_applicants_collab_sdg07` Gesuchstellerinnen und Gesuchsteller beteiligt. Am häufigsten finden Zusammenarbeiten zwischen Institutionen in der Schweiz mit solchen aus dem Ausland statt. Eine solche internationale Zusammenarbeit finden wir in `r international_collabrations_sdg07` Projekten. 

### 2023: Lancierung einer Befragung zu SDGs

Wie weiter oben erwähnt, sind die verwendeten Klassifizierungsinstrumente noch nicht vollständig ausgereift, sodass wir auf dieser Basis noch nicht abschliessend beurteilen können, wie viele Projekte tatsächlich einen Bezug zu den SDGs haben. Um diesbezüglich einen besseren und vertiefteren Einblick zu erhalten, startet der SNF 2023 eine Befragung von Projektleitenden zum konkreten Beitrag ihrer Projekte zu den SDGs. Damit verschaffen wir uns einen systematischen Überblick und sehen, wo das bestehende Wissen zur nachhaltigen Entwicklung Lücken aufweist. So können wir mit geeigneten Initiativen Forschungsprojekte anstossen, um diese Lücken zu füllen und so einen Beitrag zum Erreichen der SDGs leisten.

<div class="info-box">

### Daten

<p>Für diese Datengeschichte haben wir die Daten der bewilligten Projekte mit Förderentscheiden zwischen 2016 und 2021 verwendet. Ausgeschlossen sind alle Projekte der Wissenschaftskommunikation -- diese Kategorie umfasst Scientific Exchanges, Agora, Open-Access-Gebühren und Publikationsbeiträge. Aufgrund ihrer unterschiedlichen Struktur wurden auch die Nationalen Forschungsschwerpunkte (NFS) nicht berücksichtigt. Insgesamt wurden 12‘431 Projekte analysiert. </p>

<p><b>Projekte mit Beteiligung mehrerer Disziplinen</b> identifizierten wir anhand der entsprechenden Angaben der Gesuchstellenden (Haupt- und Nebendisziplinen, siehe <a href="https://www.snf.ch/SiteCollectionDocuments/allg_disziplinenliste.pdf" target="_blank">Disziplinenliste des SNF</a>). Die SNF-Disziplinenliste besteht aus drei Ebenen: Übergeordnet sind die drei Forschungsbereiche Geistes- und Sozialwissenschaften (GSW), Mathematik, Informatik, Naturwissenschaften und Technik (MINT) und die Lebenswissenschaften (LW). Die zweite Ebene verfeinert diese Forschungsbereiche, und die Disziplinen der Ebene drei sind noch feinkörniger. Sind in einem Projekt mindestens zwei verschiedene Disziplinen der zweiten Ebene aufgeführt, definieren wir es als Projekt mit Beteiligung mehrerer Disziplinen.</p>

<p>An <b>kollaborativen Projekten</b> sind mindestens zwei Gesuchstellende beteiligt. Dazu gehören eine korrespondierende gesuchstellende Person und mindestens eine weitere gesuchstellende Person.</p>

</div>

<!-- <div class="hide-desktop"> -->
<strong>Weiterführende Links</strong>
<p>
<a href="https://www.snf.ch/de/3DEoAgSx2yMXZaAX/thema/nachhaltige-entwicklung" target="_blank" class="button-blue">Nachhaltige Entwicklung</a>
</p>
<!-- </div> -->

Daten, Text und Code zu dieser Datengeschichte sind <a href="`r params$github`" target="_blank">auf Github verfügbar</a> und <a href="`r params$doi`" target="_blank">auf Zenodo archiviert</a>.<br>DOI: `r str_remove(params$doi, "https://doi.org/")`

```{r prevent-internal-snsf-packages, include=FALSE}
# Internal SNSF packages must not be used in data stories, as their
# pre-processing functions are internal and the corporate design differs from
# the data portal.
if (any(c("snfverse", "snf.preprocessing", "snf.plot") %in% 
        loadedNamespaces())) {
  stop(glue(
    "You must not use internal SNSF packages in data stories.",
    " Please resort to snf.datastory."
  ))
}
```
