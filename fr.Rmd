---
params: 
  title: ""
  publication_date: ""
  doi: ""
  github: ""
  lang: ""
output:
  html_document:
    anchor_sections: false
    theme: null
    highlight: null
    mathjax: null
    css: ["style.css", "https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700&display=swap"]
    self_contained: true
# output: word_document
# always_allow_html: yes
title: "`r params$title`"
editor_options: 
  chunk_output_type: console
---

```{r general-setup, include=FALSE}
## This file contains the FRENCH version of the data story

# Set general chunk options
knitr::opts_chunk$set(
  echo = FALSE, fig.showtext = TRUE, fig.retina = 3,
  fig.align = "center", warning = FALSE, message = FALSE
)

# Install snf.datastory package if not available, otherwise load it
if (!require("snf.datastory")) {
  if (!require("devtools")) {
    install.packages("devtools")
    library(devtools)
  }
  install_github("snsf-data/snf.datastory")
  library(snf.datastory)
}

# Load packages
library(tidyverse)
library(lubridate)
library(scales)
library(conflicted)
library(jsonlite)
library(here)
library(glue)
library(ggiraph)
library(treemapify)

# Conflict preferences
conflict_prefer("filter", "dplyr")
conflict_prefer("get_datastory_theme", "snf.datastory")
conflict_prefer("get_datastory_scheme", "snf.datastory")

# Increase showtext package font resolution
showtext_opts(dpi = 320)

# Set the locale for date formatting (Windows)
Sys.setlocale("LC_TIME", "French")

# Set the language for this rmd for translate function
lang <- "fr"

# Create function to print number with local language-specific format
print_num <- function(x) snf.datastory::print_num(x, lang = lang)

# Knitr hook for local formatting of printed numbers
knitr::knit_hooks$set(
  inline <- function(x) {
    if (!is.numeric(x)) {
      x
    } else {
      print_num(x)
    }
  }
)

# Function that returns the desired language version of a string, given three
# language strings are provided to the function 
translate <- function(en_string = "NOT TRANSLATED",
                      de_string = "NOT TRANSLATED",
                      fr_string = "NOT TRANSLATED",
                      lang = "en") {
  string <- case_when(lang == "en" ~ en_string, 
                      lang == "de" ~ de_string, 
                      lang == "fr" ~ fr_string, 
                      TRUE ~ "NO VALID LANGUAGE SPECIFIED")
  string
}

```

```{r print-header-infos, results='asis'}
# Add publication date to header
cat(format(as_datetime(params$publication_date), "%d.%m.%Y"))
```

```{r story-specific-setup, include=FALSE}
# Set story-specific variables etc. here

# load data comparing the different classifiers
load(here("data/sdg_mentions_all.RData"))

# load data with information regarding the mentions of sdgs (one line per grant)
load(here("data/data_grants_w_sdg.RData"))

# load data with information regarding the sdgs (one line per sdg, one grant
# can appear multiple times)
load(here("data/data_sdgs.RData"))

# load data with information regarding the disciplines involved in projects with
# reference to sdg 07 (one line per grant)
load(here("data/data_sdg07_disciplines.RData"))

# load data with information regarding the collaborations involved in projects 
# reference to sdg 07 (one line per collaboration)
load(here("data/data_sdg07_collaborations.RData"))

# make vector with sdg-colors (working with 16 sdgs)
sdg_16_colors <- c("#E5243B", "#DDA63A", "#4C9F38", "#C5192D", "#FF3A21",
                            "#26BDE2", "#FCC30B", "#A21942", "#FD6925", "#DD1367",
                            "#FD9D24", "#BF8B2E", "#3F7E44", "#0A97D9", "#56C02B",
                            "#00689D")
                            
# make vector with sdg-colors (working with 17 sdgs)
sdg_17_colors <- c("#E5243B", "#DDA63A", "#4C9F38", "#C5192D", "#FF3A21",
                            "#26BDE2", "#FCC30B", "#A21942", "#FD6925", "#DD1367",
                            "#FD9D24", "#BF8B2E", "#3F7E44", "#0A97D9", "#56C02B",
                            "#00689D", "#19486A")
                            

# define the different plot types
# plot_type1: barplot displaying SDGs faceting by another variable
plot_type1 <- function(data, facet_var, result_var,
                       y_max, upper_break, break_length,
                       sdg_color_scheme){
  
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_facet := facet_var,
           selected_result := result_var) %>%
    ggplot(aes(x = selected_result, 
               y = percentage, 
               fill = selected_result)) + 
    # choose the color
    geom_col(width = 0.75) + 
    geom_text(
      # get the percentage plus the number of cases printed as a label
      aes(
        label =
          if_else(
            percentage > 0, 
            paste0(print_num(round(percentage * 100, digits = 2)), "%"),
            ""
          ),
        # print the label outside of the bar 
        y =
          if_else(
            percentage > 0.2,
            percentage - (max(percentage) / 25),
            percentage + (max(percentage) / 25)
          ),
        hjust =
          if_else(
            percentage > 0.2,
            1,
            0
          )
      ),
      color = "#4C4C4C",
      size = 2.5, 
      family = "Theinhardt"
    ) + 
    facet_wrap(vars(selected_facet)) +
    coord_flip() +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", y = NULL) +
    get_datastory_theme() +
    # adjust the labels of the x-axis such that they don't overlap
    theme(axis.text.x = element_text(hjust = 0.5)) +
    # set the color scheme for the different sdgs
    scale_fill_manual(values = rev(sdg_color_scheme)) +
    # get rid of legend
    theme(legend.position = "none",
          panel.background = element_rect(fill = "#DAF1FC"),
          plot.background = element_rect(fill = "#DAF1FC", color = NA),
          panel.grid = element_blank())
  
}

# plot_type2: barplot displaying proportion of grants per selected category 
plot_type2 <- function(data, cat_var, facet_text,
                       y_max, upper_break, break_length){
  
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    mutate(facet_text = facet_text) %>%
    ggplot(aes(x = selected_category, 
               y = percentage)) + 
    # choose the color
    geom_col(fill = get_datastory_scheme()[1]) + 
    geom_text(
      # get the percentage plus the number of cases printed as a label
      aes(label = if_else(percentage > 0, 
                          paste0(round(percentage * 100, digits = 0), "%",
                                 "\n", "n = ", print_num(n)), ""),
          # print the label outside of the bar 
          y = percentage + (max(percentage) / 25)), 
      color = "#4C4C4C", 
      size = 2.5, 
      family = "Theinhardt", 
      hjust = 0) + 
    coord_flip() +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", 
         y = " ") +
    facet_wrap(~facet_text) +
    get_datastory_theme()
  
}

# plot_type3: barplot displaying proportion of amount awarded per selected category 
plot_type3 <- function(data, cat_var, facet_text,
                       y_max, upper_break, break_length){
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    mutate(facet_text = facet_text) %>%
    ggplot(aes(x = selected_category, 
               y = percentage)) + 
    # choose the color
    geom_col(fill = get_datastory_scheme()[1]) + 
    geom_text(
      # get the percentage plus the number of cases printed as a label
      aes(label = if_else(percentage > 0, 
                          paste0(round(percentage * 100, digits = 0), "%",
                                 "\n", print_num(
                                   round(TotalAmount / 1000000, digits = 0)),
                                 " MCHF"), ""),
          # print the label outside of the bar 
          y = percentage + (max(percentage) / 25)), 
      color = "#4C4C4C", 
      size = 2.5, 
      family = "Theinhardt", 
      hjust = 0) + 
    coord_flip() +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", 
         y = "") +
    facet_wrap(~facet_text) +
    get_datastory_theme()
  
  
}

# plot_type4: lineplot displaying proportion of approved amounts or number of 
# grants with relation to SDGs

plot_type4 <- function(data, cat_var, facet_text,
                       y_max, upper_break, break_length){
  data %>%
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    mutate(facet_text = facet_text) %>%
    ggplot(aes(x = CallDecisionYear, 
               y = percentage, 
               group = selected_category,
               color = selected_category,
               # Define tooltip text for ggiraph
               tooltip = paste0(
                 translate(
                   "Research area: ",
                   "Fachbereich: ",
                   "Domaine de recherche : ",
                   lang
                 ),
                 selected_category, "<br>",
                 translate(
                   "Percentage: ",
                   "Anteil: ",
                   "Part : ",
                   lang
                 ),
                 paste0(round(percentage * 100, 0), "%"), "<br>",
                 translate(
                   "Year: ",
                   "Jahr: ",
                   "Année : ",
                   lang
                 ),
                 CallDecisionYear, "<br>"),
               data_id = rownames(data))) + 
    geom_line(size = 0.5) +
    geom_point_interactive(shape = 16, size = 2) +
    # adjust the y-axis (percentage)
    scale_y_continuous(limits = c(0, y_max), labels = percent_format(accuracy = 1), 
                       breaks = seq(0, upper_break, break_length)) + 
    labs(x = "", 
         y = "") +
    # set the color scheme for the different sdgs
    scale_colour_manual(values = get_datastory_scheme()) +
    facet_wrap(~facet_text) +
    get_datastory_theme(gridline_axis = "y")
  
}

# plot_type5: stacked barplot displaying proportion of SDGs grants 
# per selected category 
plot_type5 <- function(data, cat_var, label_y_axis, y_min,
                       y_max, upper_break, break_length){
  data %>% 
    # in order to be able to refer to a column/variable in the data we assign 
    # it using := 
    rename(selected_category := cat_var) %>%
    ggplot(aes(x = "", 
               y = percentage,
               fill = fct_rev(selected_category))) + 
    geom_col(color = "white") + 
    # get the percentage plus the number of cases printed as a label
    geom_text(aes(label = paste0(round(percentage * 100, digits = 0), "%",
                                 "\n", "n = ", n)),
              # we want the label to be printed in the bar itself
              position = position_stack(vjust = 0.5), 
              color = "white",
              size = 2.5,
              family = "Theinhardt") +
    coord_flip() + 
    get_datastory_theme()  +
    # define the values we want the colors to have
    scale_fill_manual(values = rev(get_datastory_scheme(n_col = 2)),
                      guide = guide_legend(reverse = TRUE)) +
    labs(x = NULL, y = NULL,
         caption = label_y_axis) +
    # set up of the axis displaying the percentages
    scale_y_continuous(limits = c(y_min, y_max), expand = c(0, 0), 
                       breaks = seq(0, upper_break, break_length), 
                       labels = percent_format(accuracy = 1)) +
    # adjust the labels of the x-axis such that they don't overlap
    theme(plot.caption.position = "panel",
          plot.caption = element_text(hjust = 0)) 
}

# function to identify different discipline combinations
identify_disc_combinations <- function(data, first_disc_var, second_disc_var){
  
  data %>%
    rename(first_disc := first_disc_var,
           second_disc := second_disc_var) %>% 
    # get rid of cases where we have an NA
    filter(!is.na(first_disc),
           !is.na(second_disc)) %>%
    # always have the lower discipline as the first discipline
    mutate(first_disc_new = case_when(
      first_disc > second_disc ~ second_disc,
      first_disc < second_disc ~ first_disc),
      second_disc_new = case_when(
        first_disc > second_disc ~ first_disc,
        first_disc < second_disc ~ second_disc),
      # combine the two disciplines into one column with the lower
      # discipline first
      disc_comb = paste(first_disc_new, sep = ", ", second_disc_new)) %>%
    # only keep the number plus the combined disciplines
    select(Number, disc_comb)
  
}


```


<!-- Short lead (2-3 sentences) in bold -->

**Dans le cadre d’une analyse exploratoire, le FNS a examiné dans quelle mesure les projets qu’il encourage présentent un rapport avec les objectifs de développement durable des Nations unies. L’analyse a montré que des liens avec ces objectifs peuvent être trouvés dans l’ensemble des domaines de recherche. Une enquête menée auprès de chercheurs et chercheuses doit maintenant fournir davantage d’informations sur le sujet.**

Les dix-sept objectifs de développement durable (ODD) des Nations unies  visent à promouvoir le bien-être de toutes et tous, partout dans le monde, de manière équitable, et en protégeant le système naturel. La recherche revêt un rôle clé à cet égard : source de nouvelles connaissances, elle jette les bases de l’innovation technologique et sociale, contribuant ainsi au discours politique et social sur le développement d’actions communes et le changement de mentalité.

Au moyen de deux outils de classification, nous avons procédé à une analyse exploratoire visant à déterminer l’étendue du rapport que les projets soutenus par le FNS entretiennent avec les objectifs de développement durable. Bien que ces outils peuvent encore être améliorés (voir l’encadré « La méthode appliquée et ses limites » ci-après), les résultats qu’ils livrent permettent de se faire une première idée des travaux de recherche sur les ODD encouragés par le FNS.

<div class="info-box">

### La méthode appliquée et ses limites

<p>
Pour cette analyse, nous avons étudié divers outils de classification des ODD : le classificateur d’ODD développé par Dimensions ainsi que les systèmes d’étiquetage de texte disponibles par le biais du <a href="https://www.r-project.org/about.html" target="_blank">package R</a> <a href="https://github.com/dwulff/text2sdg#readme" target="_blank">text2dsg</a> (Aurora, Elsevier, OSDG, SDSN et SIRIS) accessibles au public. Les titres, résumés et mots-clés des projets approuvés ont été soumis à chacun de ces systèmes pour analyse. Nous avons ensuite évalué manuellement un échantillon aléatoire des résultats obtenus avec les divers outils. Pour ce faire, nous avons commencé par relever les ODD qui, selon nous, étaient abordés dans les projets approuvés, puis avons comparé notre estimation avec les résultats délivrés par les outils. En procédant de la sorte, nous avons pu identifier les outils dont les conclusions coïncidaient avec les nôtres et dont les résultats comprenaient le moins de « faux positifs ». On entend par faux positif un cas dans lequel l’outil de classification établit un lien qui s’avère inexistant entre un projet approuvé et un ODD. Notre constats : sur la base des données du FNS, ce sont les outils de Dimensions et d’Elsevier qui se sont montrés les plus fiables. Les approches de chacun d’entre eux sont brièvement expliquées ci-après.
</p>

<p>
<u>Dimensions</u><br/>
Le classificateur de Dimensions a été développé par Digital Science ; il repose sur l’apprentissage automatique. Associée à <a href="https://www.dimensions.ai/" target="_blank">Dimensions</a>, le gestionnaire de la plus grande plateforme de données structurées issues de la recherche (publications, subventions, données de recherche, etc.), <a href="https://digitalscience.figshare.com/ndownloader/files/22574228" target="_blank">Digital Science</a> a créé, sur base des dix-sept ODD, un modèle construit à l’aide d’un volume considérable de requêtes de recherche ciblées. Celui-ci a permis de générer dix-sept jeux de données d’entraînement (un pour chaque ODD) composés de publications issues de la base de données Dimensions  et, à l’aide d’outils de traitement du langage, de concevoir un système de classification des ODD. Afin d’améliorer la qualité des jeux de données d’entraînement, des vérifications visant à s’assurer que les publications identifiées correspondent bien à la description de la définition des ODD ont été effectuées régulièrement. Dans certains de ses critères de recherche, le classificateur Dimensions intègre également la recherche par proximité (*Proximity Search*, en anglais), fonction grâce à laquelle des phrases contenant des mots apparentés spécifiques sont également repérées.^[Wastl J, Hook DW, Fane B, Draux H, Porter SJ. 2020. Contextualizing Sustainable Development Research. Using Dimensions to explore the global landscape of research on Sustainable Development Goals. Digital Science. Report. <a href="https://doi.org/10.6084/m9.figshare.12200081.v2" target="_blank">https://doi.org/10.6084/m9.figshare.12200081.v2</a>]
</p>

<p>
<u>Elsevier</u><br/>
Chez Elsevier, l’équipe spécialisée dans la science des données a élaboré des <a href="https://elsevier.digitalcommonsdata.com/datasets/87txkw7khs/1" target="_blank">critères pour la recherche de travaux liés aux ODD</a>. Ceux-ci reposent sur <a href="https://www.scopus.com/" target="_blank">Scopus</a>, la base de données bibliographique sur la littérature scientifique d’Elsevier. En collaboration avec des expert·es des domaines concernés, un premier ensemble de critères de recherche sur Scopus a été développé pour chaque ODD. Une première sélection d’écrits scientifiques qui étayent les ODD a ainsi pu être établie. Le processus d'affinement des critères de recherche de travaux liés aux ODD est toutefois toujours en cours. En outre, Elsevier tient compte des commentaires de ses clients pour affiner les critères de recherche utilisés pour chaque ODD. Dans une version plus récente introduite en 2021/2022, un modèle d’apprentissage automatique est venu compléter les algorithmes de recherche. Les analyses effectuées dans le cadre de ce récit de données reposent cependant sur la version originale de 2019. L’outil d’étiquetage de texte proposé par Elsevier n’inclut pas l’ODD 17 (Partenariats pour la réalisation des objectifs). Comme nous ne comptabilisons que les projets approuvés associés à un même ODD par chacun des deux outils de classification (voir la description de l’approche dans la section suivante), cet ODD n’est pas pris en compte dans notre analyse.
</p>

<p>
<b>Restrictions</b><br/>
À l’heure actuelle, l’identification de liens avec les ODD au moyen d’outils de classification automatique connaît encore des limites : il peut ainsi arriver que des liens existants avec les ODD soient ignorés, ou -- au contraire -- que des liens « imaginaires » soient identifiés. Ce n’est pas tout : les outils tendent à favoriser un ou plusieurs ODD et à en surestimer la fréquence. De plus, en raison du nombre restreint de jeux de données de validation actuellement disponibles, il est difficile de se prononcer de manière définitive sur la fiabilité des outils de classification.^[Wulff DU, Meier DS, Mata R. 2023. Using novel data and ensemble models to improve automated labeling of Sustainable Development Goals. Preprint: <a href="https://arxiv.org/pdf/2301.11353.pdf" target="_blank">https://arxiv.org/pdf/2301.11353.pdf</a>]<br/><br/>
Pour ces raisons, nous avons opté pour approche prudente : nous avons comparé les résultats produits par Dimensions et par Elsevier et n’avons considéré l’existence d’un lien avec un ODD que lorsque les deux outils de classification identifiaient ce lien. Le but de cette approche était d’aboutir à un seuil inférieur adéquat, permettant, à terme, de dégager des tendances et de limiter les faux positifs. Si les méthodes et les mesures sont expérimentales, nous sommes malgré tout convaincus de leur intérêt : elles poursuivent le même objectif, reposent sur des approches similaires et livrent des résultats comparables.<br/><br/>
Entre-temps, les auteur·es du package R text2sdg ont développé une méthode d’assemblage de modèles (technique dite de « <a href="https://arxiv.org/pdf/2301.11353.pdf" target="_blank">Ensemble-Tool</a> ») regroupant différents outils de classification. Utiliser cette approche plutôt que la nôtre pourrait fournir des résultats d’une fiabilité accrue. Nous nous en réjouissons et suivrons de près les développements dans ce domaine.
</p>

<div class="plot-box">
<div class="plot-title">Comparaison des deux outils de classification : proportion de projets approuvés de 2016 à 2021 présentant un lien avec un ODD</div>

```{r comparison-of-classifiers, out.width="100%", fig.height=6}
# Visualize this data 
plot_data <- sdg_mentions_all %>%
  mutate(
    sdg_result_fr =
      fct_recode(
        sdg_result_fr,
        "01 Pas de pauvreté" = "01 Éradication de la pauvreté",
        "02 Faim « zéro »" = "02 Lutte contre la faim",
        "03 Bonne santé et bien-être" = "03 Accès à la santé",
        "04 Éducation de qualité" = "04 Accès à une éducation de qualité",
        "06 Eau propre et assainissement" = "06 Accès à l'eau salubre et à l'assainissement",
        "07 Énergie propre et d'un coût abordable" = "07 Recours aux énergies renouvelables",
        "08 Travail décent et croissance économique" = "08 Accès à des emplois décents",
        "10 Inégalités réduites" = "10 Réduction des inégalités",
        "13 Mesures relatives à la lutte contre les changements climatiques" = "13 Lutte contre le changement climatique",
        "16 Paix, justice et institutions efficaces" = "16 Justice et paix"
      ),
    sdg_result_de =
      fct_recode(
        sdg_result_de,
        "05 Geschlechter-Gleichheit" = "05 Geschlechter-Gleichstellung",
      )
  ) |>
  filter(!str_starts(sdg_result, "17 ")) %>%
  rename("in beiden gefunden" = freq_both, 
         Dimensions = freq_dim, 
         Elsevier = freq_elsevier) %>% 
  # transform it into long format 
  pivot_longer(
    cols = c("in beiden gefunden", Dimensions, Elsevier),
    names_to = "Classifier", 
    values_to = "percentage") %>% 
  mutate(
    sdg_result = fct_relabel(sdg_result, ~ str_wrap(.x, width = 30)),
    sdg_result_de = fct_relabel(sdg_result_de, ~ str_wrap(.x, width = 30)),
    sdg_result_fr = fct_relabel(sdg_result_fr, ~ str_wrap(.x, width = 30)),
    sdg_result = fct_rev(sdg_result),
    sdg_result_de = fct_rev(sdg_result_de),
    sdg_result_fr = fct_rev(sdg_result_fr),
    Classifier =
      recode(
        Classifier,
        "in beiden gefunden" = translate(
          "Found in both",
          "in beiden gefunden",
          "Recoupement\nDimensions/Elsevier",
          lang
        )
      )
  ) 

# make the plot using the plot_type1 function
plot_type1(data = plot_data,
           facet_var = "Classifier",
           result_var = paste0("sdg_result", translate("", "_de", "_fr", lang)),
           y_max = 0.22, upper_break = 0.2, break_length = 0.05,
           sdg_color_scheme = sdg_16_colors)

```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>


### Des recherches sur les objectifs de développement durable dans tous les domaines

Au total, l’approche retenue a établi un lien avec un ou plusieurs ODD pour 1489 des 12'431 projets approuvés depuis 2016, ce qui correspond à 12 % (voir la figure ci-dessous). Les projets approuvés en question ont été soutenus à hauteur de 709 millions de francs, ce qui équivaut à 13 % des fonds accordés. Les liens établis avec plus d’un ODD sont rares : 70 projets approuvés (0,6 %) présentaient un rapport avec deux ODD, tandis que seuls deux projets approuvés étaient liés à trois ODD.

```{r analyse-how-many-grants-are-related-to-SDGs-overall}

# How many grants have reference to SDGs
plot_data_1 <- data_grants_w_sdg %>%
  mutate(
    is_sdg_fr =
      recode(
        is_sdg_fr,
        `Pas de lien avec SDG` = "Aucun lien avec les ODD",
        `Lien avec SDG` = "Lien avec les ODD"
      ),
    is_sdg =
      recode(
        is_sdg,
        `No SDG reference` = "No link to SDGs",
        `SDG reference` = "Link to SDGs"
      ),
  ) %>%
  # count how many times we identified SDGs 
  count(
    .data[[
      paste0("is_sdg", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # calculate percentage to get an idea of the relations
  mutate(percentage = round((n / sum(n)), digits = 4))

# How much money went to projects related to SDGs
plot_data_2 <- data_grants_w_sdg %>% 
  mutate(
    is_sdg_fr =
      recode(
        is_sdg_fr,
        `Pas de lien avec SDG` = "Aucun lien avec les ODD",
        `Lien avec SDG` = "Lien avec les ODD"
      ),
    is_sdg =
      recode(
        is_sdg,
        `No SDG reference` = "No link to SDGs",
        `SDG reference` = "Link to SDGs"
      ),
  ) %>%
  # Group by is_sdg
  group_by(
    .data[[
      paste0("is_sdg", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # summarise the awarded money per is sdg or not
  summarise(TotalAmount = sum(AmountGranted)) %>% 
  mutate(percentage = 
           round(TotalAmount / sum(TotalAmount), digits = 3))
```


<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Projets approuvés de 2016 à 2021 pour lesquels un lien avec un ou plusieurs ODD a été établi (part des projets et part du montant accordé)</div>

```{r plot-2-desk, out.width="100%", fig.height=2}

# And make the plot 1
plot_type2(data = plot_data_1,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of grants",
               "Anteil der Projekte",
               "Part des projets approuvés",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2) 

# And make the plot 2
plot_type3(data = plot_data_2,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of approved funding",
               "Anteil des bewilligten Betrags",
               "Part du montant accordé",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2)

```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Projets approuvés de 2016 à 2021 pour lesquels un lien avec un ou plusieurs ODD a été établi (part des projets et part du montant accordé)</div>

```{r plot-2-phone, out.width="100%", fig.height=2}

# And make the plot 1
plot_type2(data = plot_data_1,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of grants",
               "Anteil der Projekte",
               "Part des projets approuvés",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2) 

# And make the plot 2
plot_type3(data = plot_data_2,
           cat_var = paste0("is_sdg", translate("", "_de", "_fr", lang)),
           facet_text =
             translate(
               "Percentage of approved funding",
               "Anteil des bewilligten Betrags",
               "Part du montant accordé",
               lang
             ),
           y_max = 1.3,
           upper_break = 1,
           break_length = 0.2)

```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

Une légère tendance à la hausse se dessine depuis 2016 : d’après l’approche retenue, les projets approuvés en lien avec les ODD sont toujours plus nombreux, ce qui implique davantage de moyens financiers consacrés à la recherche sur ces objectifs de développement durable. Aucune différence notable ne se dégage entre les différents domaines de recherche (sciences humaines et sociales : SHS ; mathématiques, sciences naturelles et ingénierie : MINT ; sciences de la vie : SV).

```{r analyse-how-many-grants-are-related-to-SDGs-over-time}

# how does it evolve over time - do we observe more mentions in recent years
# looking at number of grants
plot_data <- data_grants_w_sdg %>%
  group_by(
    CallDecisionYear,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # count how many times we have a mention of at least one SDG
  count(is_sdg) %>% 
  # calculate percentage to get an idea of the relations
  mutate(percentage = (n / sum(n))) %>% 
  filter(
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
    !=
      translate(
        "Interdisciplinary",
        "Interdisziplinär",
        "Interdisciplinaire",
        lang
      )
  ) %>% 
  # only keep the rows indicating how many grants had a relation to SDGs 
  filter(is_sdg == "SDG reference")

# make the plot
p_n_sdg_projects_disc <-
  plot_type4(
    data = plot_data,
    cat_var = paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang)), 
    facet_text =
      translate(
        "Percentage of grants",
        "Anteil der Projekte",
        "Part des projets approuvés",
        lang
      ),
    y_max = 0.2,
    upper_break = 0.2,
    break_length = 0.05
  )


# Create ggiraph object
girafe_n_sdg_projects_disc <- girafe(
  ggobj = p_n_sdg_projects_disc,
  height_svg = 3.5,
  options = list(
    opts_toolbar(saveaspng = FALSE),
    opts_hover(css = "fill:#F08262;stroke:#F08262;stroke-width:2"),
    opts_tooltip(
      css = get_ggiraph_tooltip_css(),
      opacity = 0.8,
      delay_mouseover = 0,
      delay_mouseout = 0
    )
  )
)


# how does it evolve over time - do we observe more mentions in recent years
# looking at approved amounts
plot_data <- data_grants_w_sdg %>% 
  group_by(
    is_sdg,
    CallDecisionYear,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  # summarise the awarded money per is sdg or not
  summarise(TotalAmount = sum(AmountGranted)) %>% 
  group_by(
    CallDecisionYear,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  mutate(percentage = 
           round(TotalAmount / sum(TotalAmount), digits = 3)) %>% 
  filter(
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]] !=
      translate(
        "Interdisciplinary",
        "Interdisziplinär",
        "Interdisciplinaire",
        lang
      )
  ) %>% 
  # only keep the rows indicating how many grants had a relation to SDGs 
  filter(is_sdg == "SDG reference") 

# make the plot
p_amount_sdg_projects_disc <-
  plot_type4(
    data = plot_data,
    cat_var = paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang)), 
    facet_text =
      translate(
        "Percentage of approved funding",
        "Anteil des bewilligten Betrags",
        "Part du montant accordé",
        lang
      ),
    y_max = 0.2,
    upper_break = 0.2,
    break_length = 0.05
  )

# Create ggiraph object
girafe_amount_sdg_projects_disc <- girafe(
  ggobj = p_amount_sdg_projects_disc,
  height_svg = 3.5,
  options = list(
    opts_toolbar(saveaspng = FALSE),
    opts_hover(css = "fill:#F08262;stroke:#F08262;stroke-width:2"),
    opts_tooltip(
      css = get_ggiraph_tooltip_css(),
      opacity = 0.8,
      delay_mouseover = 0,
      delay_mouseout = 0
    )
  )
)

```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Évolution de la proportion de projets approuvés de 2016 à 2021 pour lesquels un lien avec un ou plusieurs ODD a été établi (part des projets et part du montant accordé)</div>

```{r plot-3-desk, out.width="100%", fig.height=3}

girafe_n_sdg_projects_disc

girafe_amount_sdg_projects_disc

```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Évolution de la proportion de projets approuvés de 2016 à 2021 pour lesquels un lien avec un ou plusieurs ODD a été établi (part des projets et part du montant accordé)</div>

```{r plot-3-phone, out.width="100%", fig.height=3}

girafe_n_sdg_projects_disc

girafe_amount_sdg_projects_disc

```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

### Le climat et la santé : thèmes de recherche les plus représentés

L’approche retenue a permis de déterminer les ODD avec lesquels les projets approuvés par le FNS présentaient un lien. Les six ODD suivants ont été identifiés le plus fréquemment :

-	ODD 13 : Mesures relatives à la lutte contre les changements climatiques (3,1 % des projets analysés)
-	ODD 3 : Bonne santé et bien-être (3,1 %)
-	ODD 7 : Énergie propre et d’un coût abordable (1,9 %)
-	ODD 16 : Paix, justice et institutions efficaces (1,7 %)
-	ODD 10 : Inégalités réduites (0,5 %)
-	ODD 11 : Villes et communautés durables (0,4 %)

```{r analyse-distribution-across-sdgs-overall}

# Look at what sdgs are most often found in the approved grants only
sdg_grants_data <- sdg_mentions_all %>% 
  filter(sdg_result != "17 Partnerships for the Goals") %>% 
  select(sdg_result, freq_both, n_both) %>% 
  mutate(
    my_color = sdg_16_colors,
    sdg_result_short = str_sub(sdg_result, 1, 2),
    sdg_result_short =
      str_glue("{translate('SDG', 'SDG', 'ODD', lang)} {sdg_result_short}"),
    sdg_result = fct_reorder(sdg_result, n_both),
    sdg_n = glue::glue("{sdg_result_short}\n n = {n_both}")
  ) 
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Nombre de projets approuvés entre 2016 et 2021 par ODD</div>

```{r plot-4-desk, out.width="100%", fig.height=3.5}
# make the plot
sdg_grants_data %>%
  ggplot(aes(area = n_both, fill = my_color, label = sdg_n)) + 
  geom_treemap(start = "bottomleft") +
  geom_treemap_text(fontface = "italic", colour = "white",
                    place = "center", grow = FALSE,
                    family = "Theinhardt",
                    start = "bottomleft")+
  scale_fill_identity(
    guide = "legend",
    breaks = plot_data$my_color,
    label = plot_data$sdg_result) +
  get_datastory_theme() +
  # get legend on two rows
  guides(fill = guide_legend(nrow = 6, byrow = TRUE))

```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Nombre de projets approuvés entre 2016 et 2021 par ODD</div>

```{r plot-4-phone, out.width="100%", fig.height=3.5}
# make the plot
sdg_grants_data %>%
  ggplot(aes(area = n_both, fill = my_color, label = sdg_n)) + 
  geom_treemap(start = "bottomleft") +
  geom_treemap_text(fontface = "italic", colour = "white",
                    place = "center", grow = FALSE,
                    family = "Theinhardt",
                    start = "bottomleft")+
  scale_fill_identity(
    guide = "legend",
    breaks = plot_data$my_color,
    label = plot_data$sdg_result) +
  get_datastory_theme() +
  # get legend on two rows
  guides(fill = guide_legend(nrow = 6, byrow = TRUE))

```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

Quels domaines de recherche se consacrent à ces ODD ? Si pour les trois ODD les plus fréquemment identifiés, un domaine de recherche particulier se dégage nettement, les deux autres domaines contribuent eux aussi à approfondir les thèmes traités. Les thèmes de l’ODD 16 (Paix, justice et institutions efficaces) et de l’ODD 10 (Inégalités réduites) sont abordés quasi exclusivement par les disciplines des sciences humaines et sociales (SHS). En revanche, l’ODD 11 (Villes et communautés durables) se retrouve dans des proportions similaires dans les sciences humaines et sociales et les disciplines MINT (mathématiques, sciences naturelles et ingénierie), les sciences de la vie (SV) jouant également un rôle moindre.

```{r analyse-contribution-research-areas-top-SDGs}
# Create vector containing the top-6 sdgs
top_6_sdg <- sdg_mentions_all %>%
  slice_max(n_both, n = 6) %>% 
  mutate(sdg_result_short = str_sub(sdg_result, 1, 2)) %>%  
  mutate(
    sdg_result_short =
      paste0(translate('SDG ', 'SDG ', 'ODD ', lang), sdg_result_short)
  ) %>% 
  pull(sdg_result_short)

plot_data <- data_sdgs %>% 
  mutate(
    sdg_result = paste0(translate('SDG ', 'SDG ', 'ODD ', lang), sdg_result)
  ) %>% 
  filter(sdg_result %in% top_6_sdg,
         MainDisciplineLevel1 != "Interdisciplinary") %>% 
  group_by(
    sdg_result,
    .data[[
      paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  count(sdg_result) %>% 
  group_by(sdg_result) %>% 
  # calculate percentage to get an idea of the relations
  mutate(percentage = round((n / sum(n)), digits = 4)) %>% 
  ungroup() %>% 
  mutate(sdg_result = as_factor(sdg_result),
         sdg_result = fct_rev(fct_relevel(sdg_result, top_6_sdg)))
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Contribution des trois domaines de recherche au six ODD les plus fréquemment identifiés</div>

```{r plot-5-desk, out.width="100%", fig.height=3.5}
plot_data %>% 
  ggplot(
    aes(x = sdg_result, 
        y = percentage,
        fill =
          fct_rev(
            .data[[
              paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
            ]]
          )
    )) + 
  geom_col(color = "white") +
  # get the percentage plus the number of cases printed as a label
  geom_text(aes(label = if_else(percentage > 0.05, 
                                paste0(round(percentage * 100, digits = 0), "%",
                                       "\n", "n = ", n),
                                # if percentage is very small do not print label
                                "")),
            # we want the label to be printed in the bar itself
            position = position_stack(vjust = 0.5), 
            color = "white",
            size = 3,
            family = "Theinhardt") +
  coord_flip() + 
  # put legend to the bottom
  get_datastory_theme() +
  # define the values we want the colors to have
  scale_fill_manual(values = rev(get_datastory_scheme(n_col = 3)),
                    guide = guide_legend(reverse = TRUE)) +
  # set up of the axis displaying the percentages
  scale_y_continuous(limits = c(0, 1.05), expand = c(0, 0), 
                     breaks = seq(0, 1, 0.25), 
                     labels = percent_format(accuracy = 1)) +
  labs(x = NULL, y = NULL)  +
  theme(plot.caption.position = "panel",
        plot.caption = element_text(hjust = 0))
```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Contribution des trois domaines de recherche au six ODD les plus fréquemment identifiés</div>

```{r plot-5-phone, out.width="100%", fig.height=3.5}
plot_data %>% 
  ggplot(
    aes(x = sdg_result, 
        y = percentage,
        fill =
          fct_rev(
            .data[[
              paste0("MainDisciplineLevel1", translate("", "_de", "_fr", lang))
            ]]
          )
    )) + 
  geom_col(color = "white") +
  # get the percentage plus the number of cases printed as a label
  geom_text(aes(label = if_else(percentage > 0.05, 
                                paste0(round(percentage * 100, digits = 0), "%",
                                       "\n", "n = ", n),
                                # if percentage is very small do not print label
                                "")),
            # we want the label to be printed in the bar itself
            position = position_stack(vjust = 0.5), 
            color = "white",
            size = 3,
            family = "Theinhardt") +
  coord_flip() + 
  # put legend to the bottom
  get_datastory_theme() +
  # define the values we want the colors to have
  scale_fill_manual(values = rev(get_datastory_scheme(n_col = 3)),
                    guide = guide_legend(reverse = TRUE)) +
  # set up of the axis displaying the percentages
  scale_y_continuous(limits = c(0, 1.05), expand = c(0, 0), 
                     breaks = seq(0, 1, 0.25), 
                     labels = percent_format(accuracy = 1)) +
  labs(x = NULL, y = NULL)  +
  theme(plot.caption.position = "panel",
        plot.caption = element_text(hjust = 0))
```

<div class="caption">
Données : projets approuvés de 2016 à 2021.
</div>
</div>
</div>

### Recherche en faveur d’une énergie propre et d’un coût abordable : plusieurs disciplines impliquées

Nous abordons ci-après avec l’ODD 7 (énergie propre et d’un coût abordable), un thème d’une grande actualité. Pour 240 projets approuvés -- soit 1,9 % de ceux analysés et l’équivalent de 108 millions de francs de subsides --, l’approche retenue a établi un lien avec cet ODD.

Près de la moitié des projets approuvés (44 %) sont des projets qui impliquent plusieurs disciplines. Ce constat vaut aussi pour les autres ODD : 47 % des projets approuvés en lien avec un ODD impliquent également plusieurs disciplines. À titre de comparaison : parmi tous les autres projets financés par le FNS, seuls 41 % impliquent plus d’une discipline. Cette observation soutient la <a href="https://www.nature.com/articles/525315a" target="_blank">thèse</a> selon laquelle un renforcement de la collaboration au-delà des frontières disciplinaires permettrait de mieux faire face aux défis globaux auxquels nous sommes confrontés : les problématiques complexes requièrent la coopération, l’établissement de consensus, des processus de validation, l’échange et l’approfondissement fructueux d’idées et une communication efficace qui dépasse les frontières disciplinaires.

```{r analyse-SDG07-according-to-number-of-disciplines, out.width="100%", fig.height=1.5}
# Calculate what proportion of all grants with sdg reference had more than
# one discipline
plot_data <- data_sdgs %>% 
  filter(sdg_result == "07") %>%
  mutate(
    is_interdisciplinary_cat_de =
      fct_relevel(is_interdisciplinary_cat_de, "Eine Disziplin"),
    is_interdisciplinary_cat =
      fct_relevel(is_interdisciplinary_cat, "One discipline"),
    is_interdisciplinary_cat_fr =
      fct_relevel(is_interdisciplinary_cat_fr, "Une discipline")
  ) %>%
  distinct(Number, .keep_all = TRUE) %>% 
  group_by(
    .data[[
      paste0("is_interdisciplinary_cat", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percentage = n / sum(n)) 
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Nombre de disciplines impliquées dans les projets approuvés pour lesquels un lien avec l’ODD 7 (énergie propre et d’un coût abordable) a été établi</div>

```{r plot-6-desk, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_interdisciplinary_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)
```

<div class="caption">
Données : projets approuvés de 2016 à 2021 présentant un lien avec l’ODD 7.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Nombre de disciplines impliquées dans les projets approuvés pour lesquels un lien avec l’ODD 7 (énergie propre et d’un coût abordable) a été établi</div>

```{r plot-6-phone, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_interdisciplinary_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)
```

<div class="caption">
Données : projets approuvés de 2016 à 2021 présentant un lien avec l’ODD 7.
</div>
</div>
</div>

```{r identify-which-disciplines-come-together-most-often}

# using the function to identif discpline combinations, we use this to identify
# these combinations on all possible pairings of two disciplines for a given
# grant -> this step has to be repeated several times 
disc_1_2 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc2"
)

disc_1_3 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc3"
)

disc_1_4 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc4"
)

disc_1_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc5"
)

disc_1_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc1",
  second_disc_var = "disc6"
)

disc_2_3 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc3"
)

disc_2_4 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc4"
)

disc_2_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc5"
)

disc_2_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc2",
  second_disc_var = "disc6"
)

disc_3_4 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc3",
  second_disc_var = "disc4"
)

disc_3_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc3",
  second_disc_var = "disc5"
)

disc_3_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc3",
  second_disc_var = "disc6"
)

disc_4_5 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc4",
  second_disc_var = "disc5"
)

disc_4_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc4",
  second_disc_var = "disc6"
)

disc_5_6 <- identify_disc_combinations(
  data = data_sdg07_disciplines,
  first_disc_var = "disc5",
  second_disc_var = "disc6"
)

# now combine all of these datasets together by putting them underneath each
# other
disc_comb_sdg07 <- bind_rows(disc_1_2, disc_1_3, disc_1_4, disc_1_5, disc_1_6,
                             disc_2_3, disc_2_4, disc_2_5, disc_2_6,
                             disc_3_4, disc_3_5, disc_3_6,
                             disc_4_5, disc_4_6,
                             disc_5_6)

# get number of interdisciplinary grants that are related to sdg 07 overall
n_interdis_grants_sdg7 <- data_sdg07_disciplines %>% 
  count() %>% 
  pull()

# make table where we see 
n_disc_comb_sdg07 <- disc_comb_sdg07 %>% 
  ungroup() %>% 
  count(disc_comb) %>% 
  arrange(desc(n)) %>% 
  mutate(percentage = round((n / n_interdis_grants_sdg7) *100 , digits = 0))

```


Parmi les projets approuvés ayant un lien avec l’ODD 7, la combinaison des disciplines suivantes est la plus fréquente :

- chimie et sciences de l’ingénieur (`r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20500") %>% pull(n)` projets, `r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20500") %>% pull(percentage)` % de projets approuvés associés à plusieurs disciplines) ;
- physique et sciences de l’ingénieur (`r n_disc_comb_sdg07 %>% filter(disc_comb == "20400, 20500") %>% pull(n)` projets, `r n_disc_comb_sdg07 %>% filter(disc_comb == "20400, 20500") %>% pull(percentage)` %) ;
- chimie et physique (`r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20400") %>% pull(n)` projets, `r n_disc_comb_sdg07 %>% filter(disc_comb == "20300, 20400") %>% pull(percentage)` %).

Souvent, ces projets impliquent la collaboration d’au moins deux requérant·es. Dans le cas des projets associés à l’ODD 7, 23 % sont de nature collaborative ; un taux que l’on recense à l’échelle de l’ensemble des projets ayant un lien avec un ODD. Sur l’ensemble des projets du FNS, la proportion de projets collaboratifs n’est que de 19 %.

```{r analyse-SDG07-according-to-degree-of-collaboration, out.width="100%", fig.height=1.5}
# Calculate what proportion of all grants with sdg reference had more than
# one discipline
plot_data <- data_sdgs %>% 
  filter(sdg_result == "07") %>% 
  distinct(Number, .keep_all = TRUE) %>%
  mutate(
    is_collaborative_cat_de =
      fct_relevel(
        recode(
          is_collaborative_cat_de,
          Kollaborativ = "Mehr als eine gesuchstellende Person",
          `Nicht kollaborativ` = "Eine gesuchstellende Person"
        ),
        "Eine gesuchstellende Person"
      ),
    is_collaborative_cat =
      fct_relevel(
        recode(
          is_collaborative_cat,
          Collaborative = "More than one applicant",
          `Non-collaborative` = "One applicant"
        ),
        "One applicant"
      ),
    is_collaborative_cat_fr =
      fct_relevel(
        recode(
          is_collaborative_cat_fr,
          Collaboratif = "Plusieurs requérant·es",
          `Non collaboratif` = "Un·e requérant·e"
        ),
        "Un·e requérant·e"
      )
  ) %>%
  group_by(
    .data[[
      paste0("is_collaborative_cat", translate("", "_de", "_fr", lang))
    ]]
  ) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percentage = n / sum(n)) 
```

<div class="hide-mobile hide-tablet widemedia">
<div class="plot-box">
<div class="plot-title">Degré de collaboration au sein des projets approuvés de 2016 à 2021 pour lesquels un lien avec l’ODD 7 (énergie abordable et propre) a été établi</div>

```{r plot-7-desk, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_collaborative_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)

```

<div class="caption">
Données : projets approuvés de 2016 à 2021 présentant un lien avec l’ODD 7.
</div>
</div>
</div>

<div class="hide-desktop">
<div class="plot-box">
<div class="plot-title">Degré de collaboration au sein des projets approuvés de 2016 à 2021 pour lesquels un lien avec l’ODD 7 (énergie abordable et propre) a été établi</div>

```{r plot-7-phone, out.width="100%", fig.height=1.5}
# Plot this data
plot_type5(data = plot_data,
           cat_var = paste0("is_collaborative_cat", translate("", "_de", "_fr", lang)),
           label_y_axis = " ",
           y_min = 0, 
           y_max = 1.1,
           upper_break = 1.1,
           break_length = 0.25)

```

<div class="caption">
Données : projets approuvés de 2016 à 2021 présentant un lien avec l’ODD 7.
</div>
</div>
</div>


```{r analyse-the-type-of-collaborations}

# get the number of collaborative projects (in SDG 07)
n_collab_projects_sdg07 <- data_sdgs %>% 
  filter(sdg_result == "07",
         is_collaborative == 1) %>%
  count() %>% 
  pull()

# get the number of applicants involved in collaborative projects (with 
# reference to SDG 07)
n_applicants_collab_sdg07 <- data_sdgs %>% 
  filter(sdg_result == "07",
         is_collaborative == 1) %>%
  summarise(total_applicants = sum(n_applicants)) %>% 
  pull()

# identify the cases where collaboration was international
international_collabrations_sdg07 <- data_sdg07_collaborations %>% 
  filter(Institution2 == "International") %>%
  # only count this type of collaboration once per project, as we are now 
  # interested in knowing how many projects of the 55 have this form of 
  # collaboration
  distinct(Number, .keep_all = TRUE) %>% 
  count() %>% 
  pull()
```

Le nombre de requérant·es impliqué·es dans les `r n_collab_projects_sdg07` projets collaboratifs identifiés dans le cadre de l’ODD 7 est de `r n_applicants_collab_sdg07`. Le partenariat entre institutions suisses et étrangères, tel qu’on le recense dans `r international_collabrations_sdg07` projets, constitue la forme de collaboration la plus répandue.

### 2023 : enquête sur les ODD

Comme mentionné plus haut, les outil de classification utilisés dans l’approche retenue sont toujours en cours de perfectionnement. Il nous est dès lors impossible, à l’heure actuelle, d’affirmer avec certitude combien de projets approuvés présentent effectivement un lien avec les ODD. Afin de disposer de données plus fiables et plus détaillées, le FNS lancera, en 2023, une enquête auprès de requérant·es de projets approuvés portant sur la contribution concrète de leurs travaux aux ODD. L’objectif est de permettre d’examiner la recherche du FNS sous une perspective plus systématique et de mettre en lumière les lacunes des connaissances actuelles en matière de développement durable. Au moyen d’initiatives ciblées, nous pourrons alors lancer des projets visant à combler ces lacunes et, par conséquent, soutenir la réalisation des ODD.

<div class="info-box">

### Données

<p>Ce récit de données repose sur l’analyse des titres, résumés et mots-clés des projets approuvés de la période 2016-2021 ayant abouti à une allocation de fonds de recherche. Ont été exclus de l’analyse les projets approuvés soutenant la communication scientifique, c.-à-d. les instruments Agora, Scientific Exchanges, publications de livres en Open Access, ainsi que les subsides de publication. En raison de leur structure différente, les Pôles de recherche nationaux (PRN) n’ont également pas été pris en considération. L’analyse a porté sur un total de 12'431 projets.</p>

<p>L’identification des <b>projets approuvés impliquant plusieurs disciplines</b> s’est fondée sur les données fournies par les requérant·es lors de la soumission (voir les disciplines principales et secondaires selon la <a href="https://www.snf.ch/SiteCollectionDocuments/allg_disziplinenliste.pdf" target="_blank">liste des disciplines du FNS</a>). Cette liste se décline en trois niveaux : le premier niveau se compose des trois domaines de recherche : sciences humaines et sociales (SHS), mathématiques, informatique, sciences naturelles et ingénierie (MINT) et sciences de la vie (SV). Les deuxième et troisième niveaux sont, quant à eux, une subdivision et un approfondissement des domaines ou disciplines du niveau supérieur. Dès lors qu’un projet comporte au moins deux disciplines du deuxième niveau, il est considéré comme impliquant plusieurs disciplines.</p>

<p>Par <b>projets collaboratifs</b>, on entend les travaux de recherche menés conjointement par deux requérant·es ou plus : ces projets impliquent donc, en plus du ou de la requérant·e chargé·e de la correspondance, au moins un·e requérant·e supplémentaire.</p>

</div>

<!-- <div class="hide-desktop"> -->
<strong>Informations complémentaires</strong>
<p>
<a href="https://www.snf.ch/fr/3DEoAgSx2yMXZaAX/dossier/developpement-durable" target="_blank" class="button-blue">Développement durable</a>
</p>
<!-- </div> -->

Les données, le texte et le code de ce récit de données sont <a href="`r params$github`" target="_blank">disponibles sur Github</a> et <a href="`r params$doi`" target="_blank">archivés sur Zenodo</a>.<br>DOI: `r str_remove(params$doi, "https://doi.org/")`

```{r prevent-internal-snsf-packages, include=FALSE}
# Internal SNSF packages must not be used in data stories, as their
# pre-processing functions are internal and the corporate design differs from
# the data portal.
if (any(c("snfverse", "snf.preprocessing", "snf.plot") %in% 
        loadedNamespaces())) {
  stop(glue(
    "You must not use internal SNSF packages in data stories.",
    " Please resort to snf.datastory."
  ))
}
```
